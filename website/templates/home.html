{% extends "base.html" %}

{% block title %}AEAS | Home{% endblock %}

{% block content %}

<div class="container-whole">
  <div class="content-box" style="box-shadow: 0 0 10px 0 rgba(0, 0, 0, 1);">
 <body class="body-home">
   <div class="container">
    <div class="row">
      <div class="container">
        <div class="row">
            <div class="col-md-4">
              <h1 style="font-size: 30px;">CREATE YOUR FOLDER</h1>
                <form class="folder-create" method="POST" action="create_folder">
                    <label for="folder_name">Folder Name:</label>
                    <input type="text" name="folder_name" required>
                    <button type="submit">Create Folder</button>
                </form>
                <div style="box-shadow: 0 0 8px 0 rgba(0, 0, 0, 1);"class="folders-container">
                  <div class="content-box" style="padding-bottom: 20px;">
                    <h10 style="padding-bottom: 10px;">My Folder</h10>
                    <ul class="folder-list">
                        {% for folder in folders %}
                            <a href="./result-folder/{{ folder.id }}">
                                <li class="folder-item">
                                    <button type="button" class="close" onClick="deleteFolder('{{ folder.id }}')">
                                    <span aria-hidden="true"> <img class="delete-logo" src="{{ url_for('static', filename='del.png') }}" alt="Delete Logo"></span>
                                    </button>
                                    <img src="/static/folder.png" alt="Folder Icon" class="folder-icon">
                                    <span class="folder-name" onclick="toggleFileForm('{{ folder.id }}')" style="font-size: 14px;">{{ folder.name|upper }}</span>
                                    <div id="files-{{ folder.id }}" class="files-container" style="display: none;"></div> 
                                </li>
                            </a>
                        {% endfor %}
                    </ul>
                </div>
                </div>
            </div>
    
            <div class="col-md-4 mt-3">
                <form action="/assess" method="post" enctype="multipart/form-data">
                    <label for="additionalQuestion1">Question:</label>
                    <input type="text" class="form-control" id="additionalQuestion1" name="additionalQuestion1">
                    <label for="studentNumber">Student Number:</label>
                    <input type="text" class="form-control" id="studentNumber" name="studentNumber">
  
  
      <div class="group-essay">
        <label> Assessment Criteria: </label>
        <form action="" method="POST" id="multi-select">
            <select name="criteria" id="criteria" class="form-control selectpicker" data-live-search="true" multiple style="border: 1px solid black !important; border-radius: 4px !important; color: black !important;">-+
            <option value="clarity">Clarity of Expression </option>
            <option value="Organization">Structural Organization </option>
            <option value="Relevance">Relevance of Content </option>  
            <option value="creativity">Creativity and Originality </option>
            <option value="Grammar">Grammar and Language Usage </option>
            <option value="Focus and Details">Focus and Details </option>
          </select>
        </form>
            
        <div id="relevancePopup" class="relevance">
            <label for="relevanceWords" size="+2"><h6>Five words assessing relevance:<br>(If you select the relevance)</h6> </label>
            <input type="text" id="word1" name="word1" placeholder="Word 1">
            <input type="text" id="word2" name="word2" placeholder="Word 2">
            <input type="text" id="word3" name="word3" placeholder="Word 3">
            <input type="text" id="word4" name="word4" placeholder="Word 4">
            <input type="text" id="word5" name="word5" placeholder="Word 5">
          </div>
        
          <br/><br/>
          <label for="essay">Upload your essay:</label>
          <input type="file" name="essay" id="uploadedfilename"e accept=".doc, .docx, .txt"><br/>
          <div align="center">
          <button type="submit" class="btn btn-primary mt-3">Assess</button>
        </div>
      </form>
    </div>
  </div>


<div class="col-md-4">
  <form id="saveToFolderForm" class="mt-3" action="{{ url_for('views.save_to_folder') }}" method="post">
  <div class="data" style="margin-top: 5px;">
    <label><b>System Score</b></label>
    <input id="systemScore"  readonly type="text" style="width: 84%;background-color: rgb(228, 234, 239); margin-top: 2%;" />
  </div>  
  <div class="card-body">
    <h5 class="card-title">User Inputs</h5>
    <p><strong>Question:</strong> {{ question }}</p>
    <p><strong>Student Number: </strong>{{ student_number }}</p>
    <p><strong>Uploaded File: {{ uploaded_file_name }}</p>
  </div>
  <div id="selected-criteria">
    {% if results %}
    <div class="card mt-4">
      <div class="card-body">
        <h5 class="card-title">Assessment Results</h5>
        <ul>
          {% for criterion, result in results.items() %}
            {% if criterion == 'clarity' %}
              {% set criterion = 'Clarity' %}
            {% endif %}
            <li>{{ criterion }}: {{ result }}</li>
          {% endfor %}
        </ul>
      </div>
      <input type="hidden" id="selectedFolderId" name="selectedFolderId" />
<button type="button" class="btn btn-primary mt-3" data-toggle="modal" data-target="#folderModal">Save to folder</button>


<div class="modal fade" id="folderModal" tabindex="-1" role="dialog" aria-labelledby="folderModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="folderModalLabel">Select a Folder</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
       
        <ul id="folderList">
          {% for folder in folders %}
          <li>
              <span class="folder-icon">üìÅ</span>
              <a href="#" class="folder-name" data-folder-id="{{ folder.id }}" onclick="selectFolder(this, '{{ folder.id }}')">{{ folder.name }}</a>
              <input type="hidden" id="selectedFolderId" name="selectedFolderId" />
          </li>
          {% endfor %}
      </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="saveToFolder()">Save here</button>
      </div>
      </form>
      </div>
      <input type="hidden" name="question" value="{{ question }}">
      <input type="hidden" name="student_number" value="{{ student_number }}">
      <input type="hidden" name="essay" value="{{ uploaded_file_name }}">
      <input type="hidden" name="systemScore" value="{{ system_score }}">
      {% for criterion, result in results.items() %}
      <input type="hidden" name="result" value="{{ criterion }}: {{ result }}">
      {% endfor %}
      
    </div>
  </div>
</div>
    <form action="{{ url_for('views.export_and_download') }}" method="post">
      <input type="hidden" name="question" value="{{ question }}">
      <input type="hidden" name="student_number" value="{{ student_number }}">
      <input type="hidden" name="essay" value="{{ uploaded_file_name }}">
      {% for criterion, result in results.items() %}
        <input type="hidden" name="result" value="{{ criterion }}: {{ result }}">
      {% endfor %}
      <div style="text-align: center;">
    <button type="submit" style="font-size: 18px; color: white; background-color: blue;">Export as PDF</button>
</div>

    </form>
        </div>
      {% endif %}
      </div>
</form>

</div>
<script>
  function saveToFolder() {
      var selectedFolderId = document.getElementById("selectedFolderId").value;
      document.getElementById("selectedFolderId").value = selectedFolderId;
      document.getElementById("saveToFolderForm").submit();
  }
</script>

<script>
  function selectFolder(element, folderId) {
      document.getElementById("selectedFolderId").value = folderId;
      var folders = document.getElementsByClassName("folder-name");
      for (var i = 0; i < folders.length; i++) {
          folders[i].classList.remove("selected-folder");
      }
      element.classList.add("selected-folder");
  }
</script>

<script>
  function toggleFileForm(folderId) {
      fetch('/folders/' + folderId + '/contents')
          .then(response => response.json())
          .then(data => {
              displayFolderContents(data);
          })
          .catch(error => {
              console.error('Error fetching folder contents:', error);
          });
  }

  function displayFolderContents(contents) {
      console.log('Folder contents:', contents);
  }
</script>

<script>
  function confirmDeleteFolder(folderId, folderName) {
    var confirmation = confirm("Are you sure you want to delete this folder " + folderName + "?");

    if (confirmation) {
      deleteFolder(folderId);
    } else {
    }
  }

  function deleteFolder(folderId) {
  }
</script>

<script>
  function saveToFolder() {
      var selectedFolderId = document.getElementById("selectedFolderId").value;

      if (!selectedFolderId) {
          alert("Please select a folder before saving.");
          return;
      }
      document.getElementById("selectedFolderId").value = selectedFolderId;
      document.getElementById("saveToFolderForm").submit();
  }
</script>


</body>
</div>
</div>
{% endblock %}